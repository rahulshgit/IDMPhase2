<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isAutoPublish="false" isTracingEnabled="false" xmlns:ser="http://www.bea.com/wli/sb/services">
    <ser:description/>
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con5:SoapBindingType" xmlns:con5="http://www.bea.com/wli/sb/services/bindings/config">
      <con5:wsdl ref="VFQA_CSM_Common/WSDL/VBS/Identity/CustomerSystemUserAccount/V1/CustomerSystemUserAccountVBS"/>
      <con5:binding>
        <con5:name>CustomerSystemUserAccountInterface-SOAP11-HTTPBinding</con5:name>
        <con5:namespace>http://group.vodafone.com/contract/vbs/identity/customer-system-user-account/v1</con5:namespace>
      </con5:binding>
      <con5:selector type="SOAP body"/>
      <con5:WSI-compliant>false</con5:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
    <ser:pageAttachments isEnabled="false"/>
    <ser:transactions isRequired="false" sameTxForResponse="false"/>
  </ser:coreEntry>
  <ser:endpointConfig xmlns:ser="http://www.bea.com/wli/sb/services">
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value xmlns:env="http://www.bea.com/wli/config/env">/CustomerSystemUserAccount/VFQA_CustomerSystemUserAccount</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific xsi:type="http:HttpEndPointConfiguration" xmlns:http="http://www.bea.com/wli/sb/transports/http">
      <http:inbound-properties/>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-6219177241110839924--61f344ff.162d2620aca.-7ed3" xmlns:ser="http://www.bea.com/wli/sb/services">
    <con:pipeline type="request" name="PipelinePairNode21_request">
      <con:stage name="LogRequest1">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7ad4</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  :: Invalid Operation</con1:message>
          </con1:log>
          <con3:Error>
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7ad3</con2:id>
            <con3:errCode>Error</con3:errCode>
            <con3:message>Error</con3:message>
          </con3:Error>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-3713613156946632844--5fb82158.16373885905.-7cc8">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7c3d</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>$transactionId</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"IDM"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"Error"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>$body/*:CRM_UPDATE_USERResponse/return/code/text()</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>$body/*:CRM_UPDATE_USERResponse/return/message/text()</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-6219177241110839924--61f344ff.162d2620aca.-7eec">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7ed4</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>"Body Validation Failed"</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Technical"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>"3014"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"eGate"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"req does not contain all parameters"</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>data($validation//*:ValidationErrorList/*:ValidationError[1]/*:message)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-3713613156946632844--5fb82158.16373885905.-7f2c">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7f07</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>$transactionId</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"IDM"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"Error"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>$body/*:CRM_UNLOCK_USERResponse/return/code/text()</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>$body/*:CRM_UNLOCK_USERResponse/return/message/text()</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-3928442196395806374--77adbcdd.165188415ef.-7ed3">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7ed2</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>$transactionId</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"IDM"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"Error"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>$body/*:CRM_CHANGE_PASSWORDResponse/return/code/text()</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>$body/*:CRM_CHANGE_PASSWORDResponse/return/message/text()</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-1142851078347829058-6b94e3a0.16508d2578c.-7daa">
      <con:stage name="ErrorHandlerStage11">
        <con:context/>
        <con:actions>
          <con2:resume>
            <con2:id>_ActionId-1142851078347829058-6b94e3a0.16508d2578c.-7d3b</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="PipelinePairNode1_request">
      <con:stage name="Generate Transaction Id">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="transactionId">
            <con2:id>_ActionId-3438344862062793847--6156cfc4.164cd7be65e.-7db7</con2:id>
            <con3:expr>
              <con2:xqueryText>if(exists($header/*:Correlation/*:ConversationID/text())) then
 $header/*:Correlation/*:ConversationID/text()
else
concat("CreateUser","_",fn-bea:uuid())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestDoc">
            <con2:id>_ActionId-3874316405454465131--cc9e00c.1651350191a.-7edd</con2:id>
            <con3:expr>
              <con2:xqueryText>$body</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestHeader">
            <con2:id>_ActionId-7403373812276307397-10604d73.16537c1aa71.-7e30</con2:id>
            <con3:expr>
              <con2:xqueryText>$header</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="LogRequest" errorHandler="_onErrorHandler-6219177241110839924--61f344ff.162d2620aca.-7fd5">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7fd6</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  ::</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="ValidateRequest" errorHandler="_onErrorHandler-6219177241110839924--61f344ff.162d2620aca.-7eec">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="validation">
            <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7f63</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CreateCustomerSystemUserAccountBodyValidation"/>
                <con2:param name="createCustomerSystemUserAccountVBMRequest1">
                  <con2:path>$body/*:CreateCustomerSystemUserAccountVBMRequest</con2:path>
                </con2:param>
                <con2:param name="header">
                  <con2:path>$header</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7f4e</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>count($validation/*:ValidationErrorList/*:ValidationError) > 0</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:Error>
                  <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7f23</con2:id>
                  <con3:errCode>validation-error</con3:errCode>
                  <con3:message>validation-error</con3:message>
                </con3:Error>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="PipelinePairNode2_response"/>
    <con:pipeline type="response" name="CRM_UnlockUser1_response"/>
    <con:pipeline type="request" name="CRM_UnlockUser1_request">
      <con:stage name="Generate Transaction Id1">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="transactionId">
            <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7f90</con2:id>
            <con3:expr>
              <con2:xqueryText>if(exists($header/*:Correlation/*:ConversationID/text())) then
 $header/*:Correlation/*:ConversationID/text()
else 
concat("CRM_UPDATE_USER","_",fn-bea:uuid())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestDoc">
            <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7f8f</con2:id>
            <con3:expr>
              <con2:xqueryText>$body</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestHeader">
            <con2:id>_ActionId-7403373812276307397-10604d73.16537c1aa71.-7b26</con2:id>
            <con3:expr>
              <con2:xqueryText>$header</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="LogRequest" errorHandler="_onErrorHandler-8920523664663042246-66a48835.1651d831705.-7eae">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7f1e</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  :: CRM_UNLOCK_USER::</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="ValidateRequest" errorHandler="_onErrorHandler-8920523664663042246-66a48835.1651d831705.-7cf2">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="validation">
            <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7c52</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_UpdateCustomerSystemUserAccountBodyValidation"/>
                <con2:param name="header">
                  <con2:path>$header</con2:path>
                </con2:param>
                <con2:param name="updateCustomerSystemUserAccountVBMRequest1">
                  <con2:path>$body/*:UpdateCustomerSystemUserAccountVBMRequest</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7cf4</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>count($validation/*:ValidationErrorList/*:ValidationError) > 0</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:Error>
                  <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7cf3</con2:id>
                  <con3:errCode>validation-error</con3:errCode>
                  <con3:message>validation-error</con3:message>
                </con3:Error>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="CRM_CHANGE_PASSWORD1_request">
      <con:stage name="Generate Transaction Id">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="transactionId">
            <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7f56</con2:id>
            <con3:expr>
              <con2:xqueryText>if(exists($header/*:Correlation/*:ConversationID/text())) then
 $header/*:Correlation/*:ConversationID/text()
 else
concat("CRM_CHANGE_PASSWORD","_",fn-bea:uuid())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestDoc">
            <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7f55</con2:id>
            <con3:expr>
              <con2:xqueryText>$body</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestHeader">
            <con2:id>_ActionId-7403373812276307397-10604d73.16537c1aa71.-7aec</con2:id>
            <con3:expr>
              <con2:xqueryText>$header</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="LogRequest">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7f87</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  :: CRM_CHANGE_PASSWORD::</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="RequestSystem">
        <con:context/>
        <con:actions>
          <con3:assign varName="RequestSystem">
            <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7f54</con2:id>
            <con3:expr>
              <con2:xqueryText>$header/*:Source/*:System</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="ValidateRequest" errorHandler="_onErrorHandler-7976856096727962172--22cc42d7.16518a6101b.-76f5">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="validation">
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7731</con2:id>
            <con3:expr>
              <con2:xqueryText><![CDATA[<Validation>
	<ValidationErrorList>
               {
if(empty($header/*:Correlation/*:ConversationID/text())) then
		<ValidationError>
			<message>Input parameter 'ConversationID' is not valid</message>
		</ValidationError>
		else ''
	
		}
		    {
if(exists($body//*:CustomerSystemUserAccountVBO/*:IDs/*:ID[@schemeName="IDMAccountID" and @schemeAgencyName="Vodafone"]/text())) then
''
else
		<ValidationError>
			<message>Input parameter 'IDMAccountID' is not valid</message>
		</ValidationError>
	
		}
		
		 {
if(exists($body//*:CustomerSystemUserAccountVBO/*:IDs/*:ID[@schemeName="Password" and @schemeAgencyName="Vodafone"]/text())) then
''
else
		<ValidationError>
			<message>Input parameter 'Password' is not valid</message>
		</ValidationError>
	
		}
	</ValidationErrorList>
</Validation>]]></con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7730</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>count($validation/*:ValidationErrorList/*:ValidationError) > 0</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:Error>
                  <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-772f</con2:id>
                  <con3:errCode>validation-error</con3:errCode>
                  <con3:message>validation-error</con3:message>
                </con3:Error>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="CRM_CHANGE_PASSWORD1_response"/>
    <con:pipeline type="request" name="PipelinePairNode2_request">
      <con:stage name="LogRequest1">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7c40</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  :: Invalid Operation for UpdateUser</con1:message>
          </con1:log>
          <con3:Error>
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7bce</con2:id>
            <con3:errCode>Error</con3:errCode>
            <con3:message>Error</con3:message>
          </con3:Error>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="CRM_UpdateUser_request">
      <con:stage name="Generate Transaction Id">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="transactionId">
            <con2:id>_ActionId-3874316405454465131--cc9e00c.1651350191a.-79f5</con2:id>
            <con3:expr>
              <con2:xqueryText>if(exists($header/*:Correlation/*:ConversationID/text())) then
 $header/*:Correlation/*:ConversationID/text()
 else 
concat("CRM_UPDATE_USER","_",fn-bea:uuid())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestDoc">
            <con2:id>_ActionId-3874316405454465131--cc9e00c.1651350191a.-79f4</con2:id>
            <con3:expr>
              <con2:xqueryText>$body</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestHeader">
            <con2:id>_ActionId-7403373812276307397-10604d73.16537c1aa71.-7b43</con2:id>
            <con3:expr>
              <con2:xqueryText>$header</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="LogRequest" errorHandler="_onErrorHandler-1142851078347829058-6b94e3a0.16508d2578c.-7daa">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-1142851078347829058-6b94e3a0.16508d2578c.-7dad</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  :: CRM_UPDATE_USER::</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="ValidateRequest" errorHandler="_onErrorHandler-7976856096727962172--22cc42d7.16518a6101b.-78fe">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="validation">
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7903</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_UpdateCustomerSystemUserAccountBodyValidation"/>
                <con2:param name="header">
                  <con2:path>$header</con2:path>
                </con2:param>
                <con2:param name="updateCustomerSystemUserAccountVBMRequest1">
                  <con2:path>$body/*:UpdateCustomerSystemUserAccountVBMRequest</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7902</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>count($validation/*:ValidationErrorList/*:ValidationError) > 0</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:Error>
                  <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7901</con2:id>
                  <con3:errCode>validation-error</con3:errCode>
                  <con3:message>validation-error</con3:message>
                </con3:Error>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="RequestHeaderStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="RequestHeader">
            <con2:id>_ActionId-495976954301865106--63101692.162e8dd6d0e.-7f7b</con2:id>
            <con3:expr>
              <con2:xqueryText>$header/*:Source/*:System</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="PipelinePairNode1_response"/>
    <con:pipeline type="error" name="_onErrorHandler-7976856096727962172--22cc42d7.16518a6101b.-78fe">
      <con:stage name="ErrorHandlerStage11">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-788f</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>"Body Validation Failed"</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Technical"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>"3014"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"eGate"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"req does not contain all parameters"</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>data($validation//*:ValidationErrorList/*:ValidationError[1]/*:message)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-6219177241110839924--61f344ff.162d2620aca.-7fd5">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con2:resume>
            <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7f85</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8920523664663042246-66a48835.1651d831705.-7cf2">
      <con:stage name="ErrorHandlerStage111">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7c83</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>"Body Validation Failed"</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Technical"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>"3014"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"eGate"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"req does not contain all parameters"</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>data($validation//*:ValidationErrorList/*:ValidationError[1]/*:message)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-7976856096727962172--22cc42d7.16518a6101b.-76f5">
      <con:stage name="ErrorHandlerStage1111">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-76bd</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>"Body Validation Failed"</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Technical"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>"3014"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"eGate"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"req does not contain all parameters"</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>data($validation//*:ValidationErrorList/*:ValidationError[1]/*:message)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="PipelinePairNode21_response"/>
    <con:pipeline type="error" name="_onErrorHandler-3713613156946632844--5fb82158.16373885905.-78f6">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7887</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>$transactionId</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"IDM"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"Error"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>$body/*:CRM_CREATE_USERResponse/return/code/text()</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>$body/*:CRM_CREATE_USERResponse/return/message/text()</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8920523664663042246-66a48835.1651d831705.-7eae">
      <con:stage name="ErrorHandlerStage111">
        <con:context/>
        <con:actions>
          <con2:resume>
            <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7e76</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-6219177241110839924--61f344ff.162d2620aca.-7ed3">
      <con:stage name="PipelineErrorHandler">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:replace varName="body" contents-only="true">
            <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7ea5</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_InternalFault"/>
                <con2:param name="request">
                  <con2:path><![CDATA[let $errorVal := data($errorinfo/*:ErrorCode)
return
	if (matches($errorVal, "^\s*$"))
	then
		<err:ErrorInformation xmlns:err="http://www.vodafone.qa/ErrorInformation">
<err:ErrorCode>500</err:ErrorCode>
<err:ErrorDetail>Internal Server Error</err:ErrorDetail>
</err:ErrorInformation>
	else
		$errorinfo]]></con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:replace>
          <con3:replace varName="body" contents-only="true">
            <con2:id>_ActionId-6219177241110839924--61f344ff.162d2620aca.-7e83</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_ExternalFault"/>
                <con2:param name="fault">
                  <con2:path>$body/*:Fault</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:replace>
          <con1:log>
            <con2:id>_ActionId-3438344862062793847--6156cfc4.164cd7be65e.-7eb1</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Error Response sent back to Client ::</con1:message>
          </con1:log>
          <con2:reply isError="true">
            <con2:id>_ActionId-735758459701642425--4627b849.162d7a07266.-7fee</con2:id>
          </con2:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="CRM_UpdateUser_response"/>
    <con:pipeline type="request" name="CRM_LINK_MSISDN_request">
      <con:stage name="Generate Transaction Id">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="transactionId">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c95</con2:id>
            <con3:expr>
              <con2:xqueryText>if(exists($header/*:Correlation/*:ConversationID/text())) then
 $header/*:Correlation/*:ConversationID/text()
 else 
concat("CRM_LINK_MSISDN","_",fn-bea:uuid())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestDoc">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c94</con2:id>
            <con3:expr>
              <con2:xqueryText>$body</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestHeader">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c93</con2:id>
            <con3:expr>
              <con2:xqueryText>$header</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="LogRequest" errorHandler="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c91">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c92</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  :: CRM_LINK_MSISDN::</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="ValidateRequest" errorHandler="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c8c">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="validation">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c8f</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_SyncCustomerSystemUserAccountBodyValidation"/>
                <con2:param name="header">
                  <con2:path>$header</con2:path>
                </con2:param>
                <con2:param name="syncCustomerSystemUserAccountVBMRequest1">
                  <con2:path>$body/*:SyncCustomerSystemUserAccountVBMRequest</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c8e</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>count($validation/*:ValidationErrorList/*:ValidationError) > 0</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:Error>
                  <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c8d</con2:id>
                  <con3:errCode>validation-error</con3:errCode>
                  <con3:message>validation-error</con3:message>
                </con3:Error>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="RequestHeaderStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="RequestHeader">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c8a</con2:id>
            <con3:expr>
              <con2:xqueryText>$header/*:Source/*:System</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="CheckIDNumber" errorHandler="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c83">
        <con:context xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/payment/customer-bill/v1" prefix="v1"/>
          <con2:varNsDecl prefix="urn" namespace="urn:un:unece:uncefact:documentation:standard:CoreComponentType:2"/>
          <con2:varNsDecl prefix="bf" namespace="http://docs.oasis-open.org/wsrf/bf-2"/>
          <con2:varNsDecl prefix="v11" namespace="http://group.vodafone.com/contract/vho/header/v1"/>
          <con2:varNsDecl prefix="xml" namespace="http://www.w3.org/XML/1998/namespace"/>
          <con2:varNsDecl prefix="v12" namespace="http://group.vodafone.com/schema/common/v1"/>
          <con2:varNsDecl prefix="v13" namespace="http://group.vodafone.com/contract/vfo/fault/v1"/>
          <con2:varNsDecl prefix="v14" namespace="http://group.vodafone.com/schema/vbo/payment/customer-bill/v1"/>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v15"/>
        </con:context>
        <con:actions xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
          <con3:wsCallout>
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c84</con2:id>
            <con3:service xsi:type="ref:BusinessServiceRef" ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_GetIDDetails" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con3:operation>GetIDDetails</con3:operation>
            <con3:request>
              <con3:body wrapped="true">$body</con3:body>
            </con3:request>
            <con3:response>
              <con3:body wrapped="true">body</con3:body>
            </con3:response>
            <con3:requestTransform>
              <con3:replace contents-only="true" varName="body">
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c89</con2:id>
                <con3:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_SyncCustomerSystemUserAccount_to_ODSGetIDDetailsRequest"/>
                    <con2:param name="syncCustomerSystemUserAccountVBMRequest1">
                      <con2:path>$body/*:SyncCustomerSystemUserAccountVBMRequest</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con3:expr>
              </con3:replace>
              <con1:log>
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c88</con2:id>
                <con1:logLevel>info</con1:logLevel>
                <con1:expr>
                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                </con1:expr>
                <con1:message>Request sent to ODS :-</con1:message>
              </con1:log>
            </con3:requestTransform>
            <con3:responseTransform>
              <con1:log>
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c87</con2:id>
                <con1:logLevel>info</con1:logLevel>
                <con1:expr>
                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                </con1:expr>
                <con1:message>Response received from ODS :-</con1:message>
              </con1:log>
              <con3:assign varName="ODSIDResponse">
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c86</con2:id>
                <con3:expr>
                  <con2:xqueryText>$body</con2:xqueryText>
                </con3:expr>
              </con3:assign>
              <con3:assign varName="chk">
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c85</con2:id>
                <con3:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($ODSIDResponse/*:API_CUR/*:Row/*:Column[@name = 'PRIM_ID_NUMBER'])</con:xqueryText>
                </con3:expr>
              </con3:assign>
            </con3:responseTransform>
          </con3:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="GetCustomerIDMProfile" errorHandler="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c6e">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:wsCallout xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c6f</con2:id>
            <con3:service xsi:type="ref:BusinessServiceRef" ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con3:operation>CRM_SEARCH_ALL_USER</con3:operation>
            <con3:request>
              <con3:body wrapped="true">$body</con3:body>
            </con3:request>
            <con3:response>
              <con3:body wrapped="true">body</con3:body>
            </con3:response>
            <con3:requestTransform>
              <con3:replace contents-only="true" varName="body">
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c7a</con2:id>
                <con3:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_SyncCustomerSystemUserAccountVBMRequest_to_IDMSearchUserRequest"/>
                    <con2:param name="syncCustomerSystemUserAccountVBMRequest1">
                      <con2:path>$requestDoc/*:SyncCustomerSystemUserAccountVBMRequest</con2:path>
                    </con2:param>
                    <con2:param name="transactionId">
                      <con2:path>$transactionId</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con3:expr>
              </con3:replace>
              <con1:log>
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c79</con2:id>
                <con1:logLevel>info</con1:logLevel>
                <con1:expr>
                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                </con1:expr>
                <con1:message>Request sent to IDM :-</con1:message>
              </con1:log>
            </con3:requestTransform>
            <con3:responseTransform>
              <con1:log>
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c78</con2:id>
                <con1:logLevel>info</con1:logLevel>
                <con1:expr>
                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                </con1:expr>
                <con1:message>Response received from IDM :-</con1:message>
              </con1:log>
              <con3:ifThenElse>
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c77</con2:id>
                <con3:case>
                  <con3:condition>
                    <con2:xqueryConditionExpr>
                      <con2:compExpr operator="=">
                        <con2:leftPath>$body/*:CRM_SEARCH_ALL_USERResponse/return/code/text()</con2:leftPath>
                        <con2:rightPath>200</con2:rightPath>
                      </con2:compExpr>
                    </con2:xqueryConditionExpr>
                  </con3:condition>
                  <con3:actions>
                    <con3:assign varName="IDMGetProfileResponse">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c76</con2:id>
                      <con3:expr>
                        <con2:xqueryText>$body</con2:xqueryText>
                      </con3:expr>
                    </con3:assign>
                  </con3:actions>
                </con3:case>
                <con3:default>
                  <con3:ifThenElse>
                    <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c75</con2:id>
                    <con3:case>
                      <con3:condition>
                        <con2:xqueryText>exists($body/*:CRM_SEARCH_ALL_USERResponse/*:return/*:code/text()) and 
exists($body/*:CRM_SEARCH_ALL_USERResponse/*:return/*:message/text())</con2:xqueryText>
                      </con3:condition>
                      <con3:actions>
                        <con3:assign varName="errorCode">
                          <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7e83</con2:id>
                          <con3:expr>
                            <con2:xqueryText>$body/*:CRM_SEARCH_ALL_USERResponse/*:return/*:code/text()</con2:xqueryText>
                          </con3:expr>
                        </con3:assign>
                        <con3:assign varName="errorDVM">
                          <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7e81</con2:id>
                          <con3:expr>
                            <con2:xqueryTransform>
                              <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                            </con2:xqueryTransform>
                          </con3:expr>
                        </con3:assign>
                        <con3:replace varName="header">
                          <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7e7f</con2:id>
                          <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                          </con3:location>
                          <con3:expr>
                            <con2:xqueryTransform>
                              <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                              <con2:param name="reasonCode">
                                <con2:path>$errorCode</con2:path>
                              </con2:param>
                              <con2:param name="message">
                                <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                              </con2:param>
                              <con2:param name="transactionId">
                                <con2:path>$transactionId</con2:path>
                              </con2:param>
                            </con2:xqueryTransform>
                          </con3:expr>
                        </con3:replace>
                        <con3:replace varName="body">
                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c73</con2:id>
                          <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                          </con3:location>
                          <con3:expr>
                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                          </con3:expr>
                        </con3:replace>
                        <con1:log>
                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c72</con2:id>
                          <con1:logLevel>info</con1:logLevel>
                          <con1:expr>
                            <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                          </con1:expr>
                          <con1:message>Response sent to Client::</con1:message>
                        </con1:log>
                        <con2:reply>
                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c71</con2:id>
                        </con2:reply>
                      </con3:actions>
                    </con3:case>
                    <con3:default>
                      <con3:Error>
                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c70</con2:id>
                        <con3:errCode>error</con3:errCode>
                        <con3:message>error</con3:message>
                      </con3:Error>
                    </con3:default>
                  </con3:ifThenElse>
                </con3:default>
              </con3:ifThenElse>
            </con3:responseTransform>
          </con3:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="CompareIDNumbers">
        <con:context/>
        <con:actions>
          <con3:assign varName="matchStatus">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c6c</con2:id>
            <con3:expr>
              <con2:xqueryText>let 
    $idm_idno := upper-case($IDMGetProfileResponse/*:CRM_SEARCH_ALL_USERResponse/return/ID_Number/text()),
    $idm_idtype := upper-case($IDMGetProfileResponse/*:CRM_SEARCH_ALL_USERResponse/return/ID_Type/text()),
    $ods_idno:= upper-case($ODSIDResponse/*:OutputParameters/*:API_CUR/*:Row/*:Column[@name="PRIM_ID_NUMBER"]/text()),
    $ods_idtype:=upper-case($ODSIDResponse/*:OutputParameters/*:API_CUR/*:Row/*:Column[@name="PRIM_ID_TYPE"]/text()) 
return 
if(($idm_idno=$ods_idno) and ($ods_idtype=$idm_idtype)) then
'matching'
else 
'not matching'</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c6b</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>$matchStatus='matching'</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:wsCallout>
                  <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c5f</con2:id>
                  <con3:service xsi:type="ref:BusinessServiceRef" ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con3:operation>getChildProcessFormData</con3:operation>
                  <con3:request>
                    <con3:body wrapped="true">$body</con3:body>
                  </con3:request>
                  <con3:response>
                    <con3:body wrapped="true">body</con3:body>
                  </con3:response>
                  <con3:requestTransform>
                    <con3:replace contents-only="true" varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c6a</con2:id>
                      <con3:expr>
                        <con2:xqueryText><![CDATA[<idm:getChildProcessFormData xmlns:idm="http://vodafoneqatar.qa/vfqa/IDM_Phase2">
	<arg0>{data($IDMGetProfileResponse/*:CRM_SEARCH_ALL_USERResponse/*:return/*:IDMAccountId)}</arg0>
	<arg1>{data($IDMGetProfileResponse/*:CRM_SEARCH_ALL_USERResponse/*:return/*:user_Login)}</arg1>
	<arg2>{$transactionId}</arg2>
</idm:getChildProcessFormData>]]></con2:xqueryText>
                      </con3:expr>
                    </con3:replace>
                    <con1:log>
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c69</con2:id>
                      <con1:logLevel>info</con1:logLevel>
                      <con1:expr>
                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body),". count -",$ind)</con2:xqueryText>
                      </con1:expr>
                      <con1:message>Request sent to IDM :-</con1:message>
                    </con1:log>
                  </con3:requestTransform>
                  <con3:responseTransform>
                    <con1:log>
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c68</con2:id>
                      <con1:logLevel>info</con1:logLevel>
                      <con1:expr>
                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                      </con1:expr>
                      <con1:message>Response received from  IDM :-</con1:message>
                    </con1:log>
                    <con3:assign varName="msisdnStatus">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c67</con2:id>
                      <con3:expr>
                        <con2:xqueryText><![CDATA[let $msisdn:=$requestDoc//*:CustomerSystemUserAccountVBO/*:Parts/*:Subscriptions/*:Subscription/*:MSISDN/text(),
 $full:=concat($msisdn,",Full"),
 $notfull:=concat($msisdn,",Restricted"),
 $countList:=

<a>
<countFull>{count($body/*:getChildProcessFormDataResponse/*:return[./text()=$full])}</countFull>
<countRest>{count($body/*:getChildProcessFormDataResponse/*:return[./text()=$notfull])}</countRest>
</a>
return 

if(($countList/*:countFull/text()="0") and ($countList/*:countRest/text()="0")) then
"New"
else
"AlreadyLinked"]]></con2:xqueryText>
                      </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c66</con2:id>
                      <con3:case>
                        <con3:condition>
                          <con2:xqueryText>$msisdnStatus="AlreadyLinked"</con2:xqueryText>
                        </con3:condition>
                        <con3:actions>
                          <con3:assign varName="errorCode">
                            <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7d26</con2:id>
                            <con3:expr>
                              <con2:xqueryText>"1018"</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                          <con3:assign varName="errorDVM">
                            <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7d24</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                          <con3:replace varName="header">
                            <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7d22</con2:id>
                            <con3:location>
                              <con2:xpathText>.</con2:xpathText>
                            </con3:location>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                <con2:param name="reasonCode">
                                  <con2:path>$errorCode</con2:path>
                                </con2:param>
                                <con2:param name="message">
                                  <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                </con2:param>
                                <con2:param name="transactionId">
                                  <con2:path>$transactionId</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:replace>
                          <con3:replace varName="body">
                            <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7d20</con2:id>
                            <con3:location>
                              <con2:xpathText>.</con2:xpathText>
                            </con3:location>
                            <con3:expr>
                              <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                            </con3:expr>
                          </con3:replace>
                          <con1:log>
                            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c62</con2:id>
                            <con1:logLevel>info</con1:logLevel>
                            <con1:expr>
                              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                            </con1:expr>
                            <con1:message>Response sent to Client::</con1:message>
                          </con1:log>
                          <con2:reply>
                            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c61</con2:id>
                          </con2:reply>
                        </con3:actions>
                      </con3:case>
                      <con3:default>
                        <con1:log>
                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c60</con2:id>
                          <con1:logLevel>info</con1:logLevel>
                          <con1:expr>
                            <con2:xqueryText>concat("TransactionId -",$transactionId )</con2:xqueryText>
                          </con1:expr>
                          <con1:message>Proceeding for linking</con1:message>
                        </con1:log>
                      </con3:default>
                    </con3:ifThenElse>
                  </con3:responseTransform>
                </con3:wsCallout>
                <con3:wsCallout>
                  <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c54</con2:id>
                  <con3:service xsi:type="ref:BusinessServiceRef" ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con3:operation>LINK_MSISDN</con3:operation>
                  <con3:request>
                    <con3:body wrapped="true">$body</con3:body>
                  </con3:request>
                  <con3:response>
                    <con3:body wrapped="true">body</con3:body>
                  </con3:response>
                  <con3:requestTransform>
                    <con3:replace contents-only="true" varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c5e</con2:id>
                      <con3:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_SyncCustomerSystemUserAccountVBMRequest_to_IDMLinkMSISDNRequest"/>
                          <con2:param name="linkStatus">
                            <con2:path>"Full"</con2:path>
                          </con2:param>
                          <con2:param name="IDMGetProfileResponse">
                            <con2:path>$IDMGetProfileResponse</con2:path>
                          </con2:param>
                          <con2:param name="syncCustomerSystemUserAccountVBMRequest1">
                            <con2:path>$requestDoc/*:SyncCustomerSystemUserAccountVBMRequest</con2:path>
                          </con2:param>
                          <con2:param name="transactionId">
                            <con2:path>$transactionId</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con3:expr>
                    </con3:replace>
                    <con1:log xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c5d</con2:id>
                      <con1:logLevel>info</con1:logLevel>
                      <con1:expr>
                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                      </con1:expr>
                      <con1:message>Request sent to IDM :-</con1:message>
                    </con1:log>
                  </con3:requestTransform>
                  <con3:responseTransform>
                    <con1:log xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c5c</con2:id>
                      <con1:logLevel>info</con1:logLevel>
                      <con1:expr>
                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                      </con1:expr>
                      <con1:message>Response received from  IDM :-</con1:message>
                    </con1:log>
                    <con3:ifThenElse xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c5b</con2:id>
                      <con3:case>
                        <con3:condition>
                          <con2:xqueryConditionExpr>
                            <con2:compExpr operator="=">
                              <con2:leftPath>$body/*:LINK_MSISDNResponse/return/code/text()</con2:leftPath>
                              <con2:rightPath>200</con2:rightPath>
                            </con2:compExpr>
                          </con2:xqueryConditionExpr>
                        </con3:condition>
                        <con3:actions/>
                      </con3:case>
                      <con3:default>
                        <con3:ifThenElse>
                          <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c37</con2:id>
                          <con3:case>
                            <con3:condition>
                              <con2:xqueryText>exists($body/*:LINK_MSISDNResponse/*:return/*:code/text()) and 
exists($body/*:LINK_MSISDNResponse/*:return/*:message/text())</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                              <con3:assign varName="errorCode">
                                <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c36</con2:id>
                                <con3:expr>
                                  <con2:xqueryText>$body/*:LINK_MSISDNResponse/*:return/*:code/text()</con2:xqueryText>
                                </con3:expr>
                              </con3:assign>
                              <con3:assign varName="errorDVM">
                                <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c35</con2:id>
                                <con3:expr>
                                  <con2:xqueryTransform>
                                    <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                                  </con2:xqueryTransform>
                                </con3:expr>
                              </con3:assign>
                              <con3:replace varName="header">
                                <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c34</con2:id>
                                <con3:location>
                                  <con2:xpathText>.</con2:xpathText>
                                </con3:location>
                                <con3:expr>
                                  <con2:xqueryTransform>
                                    <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                    <con2:param name="reasonCode">
                                      <con2:path>$errorCode</con2:path>
                                    </con2:param>
                                    <con2:param name="message">
                                      <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                    </con2:param>
                                    <con2:param name="transactionId">
                                      <con2:path>$transactionId</con2:path>
                                    </con2:param>
                                  </con2:xqueryTransform>
                                </con3:expr>
                              </con3:replace>
                              <con3:replace varName="body">
                                <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c33</con2:id>
                                <con3:location>
                                  <con2:xpathText>.</con2:xpathText>
                                </con3:location>
                                <con3:expr>
                                  <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                                </con3:expr>
                              </con3:replace>
                              <con1:log>
                                <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c32</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Response sent to Client::</con1:message>
                              </con1:log>
                              <con2:reply>
                                <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c31</con2:id>
                              </con2:reply>
                            </con3:actions>
                          </con3:case>
                          <con3:default>
                            <con3:Error>
                              <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7c30</con2:id>
                              <con3:errCode>error</con3:errCode>
                              <con3:message>error</con3:message>
                            </con3:Error>
                          </con3:default>
                        </con3:ifThenElse>
                      </con3:default>
                    </con3:ifThenElse>
                  </con3:responseTransform>
                </con3:wsCallout>
              </con3:actions>
            </con3:case>
            <con3:default>
              <con3:assign varName="requestData">
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c53</con2:id>
                <con3:expr>
                  <con2:xqueryText><![CDATA[<Details>
	<IDNumber>{data($requestDoc/*:SyncCustomerSystemUserAccountVBMRequest/*:CustomerSystemUserAccountVBO/*:Roles/*:Holder/*:IDs/*:ID)}</IDNumber>			  
	<IDType>{data($requestDoc/*:SyncCustomerSystemUserAccountVBMRequest/*:CustomerSystemUserAccountVBO/*:Roles/*:Holder/*:Type)}</IDType>	
</Details>]]></con2:xqueryText>
                </con3:expr>
              </con3:assign>
              <con3:ifThenElse>
                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c52</con2:id>
                <con3:case>
                  <con3:condition>
                    <con2:xqueryText>exists($requestData/*:IDNumber/text()) and exists($requestData/*:IDType/text())</con2:xqueryText>
                  </con3:condition>
                  <con3:actions>
                    <con3:assign varName="matchStatusForChallengeID">
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c51</con2:id>
                      <con3:expr>
                        <con2:xqueryText>let 
      $ods_idno:= upper-case($ODSIDResponse/*:OutputParameters/*:API_CUR/*:Row/*:Column[@name="PRIM_ID_NUMBER"]/text()),
    $ods_idtype:=upper-case($ODSIDResponse/*:OutputParameters/*:API_CUR/*:Row/*:Column[@name="PRIM_ID_TYPE"]/text()),
    $new_ods_idtype := if($ods_idtype eq "QATARI ID") then
	"QATARIID"
	else 
	$new_ods_idtype
return 
if((upper-case(data($requestData/*:IDNumber)) eq $ods_idno) and
 (upper-case(data($requestData/*:IDType)) eq $new_ods_idtype)) then
'matching'
else 
'not matching'</con2:xqueryText>
                      </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c50</con2:id>
                      <con3:case>
                        <con3:condition>
                          <con2:xqueryText>$matchStatusForChallengeID='matching'</con2:xqueryText>
                        </con3:condition>
                        <con3:actions>
                          <con3:wsCallout>
                            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c44</con2:id>
                            <con3:service xsi:type="ref:BusinessServiceRef" ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con3:operation>getChildProcessFormData</con3:operation>
                            <con3:request>
                              <con3:body wrapped="true">$body</con3:body>
                            </con3:request>
                            <con3:response>
                              <con3:body wrapped="true">body</con3:body>
                            </con3:response>
                            <con3:requestTransform>
                              <con3:replace contents-only="true" varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c4f</con2:id>
                                <con3:expr>
                                  <con2:xqueryText><![CDATA[<idm:getChildProcessFormData xmlns:idm="http://vodafoneqatar.qa/vfqa/IDM_Phase2">
	<arg0>{data($IDMGetProfileResponse/*:CRM_SEARCH_ALL_USERResponse/*:return/*:IDMAccountId)}</arg0>
	<arg1>{data($IDMGetProfileResponse/*:CRM_SEARCH_ALL_USERResponse/*:return/*:user_Login)}</arg1>
<arg2>{$transactionId}</arg2>
</idm:getChildProcessFormData>]]></con2:xqueryText>
                                </con3:expr>
                              </con3:replace>
                              <con1:log>
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c4e</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body),". count -",$ind)</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Request sent to IDM :-</con1:message>
                              </con1:log>
                            </con3:requestTransform>
                            <con3:responseTransform>
                              <con1:log>
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c4d</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Response received from  IDM :-</con1:message>
                              </con1:log>
                              <con3:assign varName="msisdnStatus">
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c4c</con2:id>
                                <con3:expr>
                                  <con2:xqueryText><![CDATA[let $msisdn:=$requestDoc//*:CustomerSystemUserAccountVBO/*:Parts/*:Subscriptions/*:Subscription/*:MSISDN/text(),
 $full:=concat($msisdn,",Full"),
 $notfull:=concat($msisdn,",Restricted"),
 $countList:=

<a>
<countFull>{count($body/*:getChildProcessFormDataResponse/*:return[./text()=$full])}</countFull>
<countRest>{count($body/*:getChildProcessFormDataResponse/*:return[./text()=$notfull])}</countRest>
</a>
return 

if(($countList/*:countFull/text()="0") and ($countList/*:countRest/text()="0")) then
"New"
else
"AlreadyLinked"]]></con2:xqueryText>
                                </con3:expr>
                              </con3:assign>
                              <con3:ifThenElse xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c4b</con2:id>
                                <con3:case>
                                  <con3:condition>
                                    <con2:xqueryText>$msisdnStatus="AlreadyLinked"</con2:xqueryText>
                                  </con3:condition>
                                  <con3:actions>
                                    <con3:assign varName="errorCode">
                                      <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7d98</con2:id>
                                      <con3:expr>
                                        <con2:xqueryText>"1018"</con2:xqueryText>
                                      </con3:expr>
                                    </con3:assign>
                                    <con3:assign varName="errorDVM">
                                      <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7a0a</con2:id>
                                      <con3:expr>
                                        <con2:xqueryTransform>
                                          <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                                        </con2:xqueryTransform>
                                      </con3:expr>
                                    </con3:assign>
                                    <con3:replace varName="header">
                                      <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7d26</con2:id>
                                      <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                      </con3:location>
                                      <con3:expr>
                                        <con2:xqueryTransform>
                                          <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                          <con2:param name="reasonCode">
                                            <con2:path>$errorCode</con2:path>
                                          </con2:param>
                                          <con2:param name="message">
                                            <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                          </con2:param>
                                          <con2:param name="transactionId">
                                            <con2:path>$transactionId</con2:path>
                                          </con2:param>
                                        </con2:xqueryTransform>
                                      </con3:expr>
                                    </con3:replace>
                                    <con3:replace varName="body">
                                      <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7c7f</con2:id>
                                      <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                      </con3:location>
                                      <con3:expr>
                                        <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                                      </con3:expr>
                                    </con3:replace>
                                    <con1:log>
                                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c47</con2:id>
                                      <con1:logLevel>info</con1:logLevel>
                                      <con1:expr>
                                        <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                      </con1:expr>
                                      <con1:message>Response sent to Client::</con1:message>
                                    </con1:log>
                                    <con2:reply>
                                      <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c46</con2:id>
                                    </con2:reply>
                                  </con3:actions>
                                </con3:case>
                                <con3:default>
                                  <con1:log>
                                    <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c45</con2:id>
                                    <con1:logLevel>info</con1:logLevel>
                                    <con1:expr>
                                      <con2:xqueryText>concat("TransactionId -",$transactionId )</con2:xqueryText>
                                    </con1:expr>
                                    <con1:message>Proceeding for linking</con1:message>
                                  </con1:log>
                                </con3:default>
                              </con3:ifThenElse>
                            </con3:responseTransform>
                          </con3:wsCallout>
                          <con3:wsCallout>
                            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c39</con2:id>
                            <con3:service xsi:type="ref:BusinessServiceRef" ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con3:operation>LINK_MSISDN</con3:operation>
                            <con3:request>
                              <con3:body wrapped="true">$body</con3:body>
                            </con3:request>
                            <con3:response>
                              <con3:body wrapped="true">body</con3:body>
                            </con3:response>
                            <con3:requestTransform>
                              <con3:replace contents-only="true" varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7633</con2:id>
                                <con3:expr>
                                  <con2:xqueryTransform>
                                    <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_SyncCustomerSystemUserAccountVBMRequest_to_IDMLinkMSISDNRequest"/>
                                    <con2:param name="linkStatus">
                                      <con2:path>"Restricted"</con2:path>
                                    </con2:param>
                                    <con2:param name="IDMGetProfileResponse">
                                      <con2:path>$IDMGetProfileResponse</con2:path>
                                    </con2:param>
                                    <con2:param name="syncCustomerSystemUserAccountVBMRequest1">
                                      <con2:path>$requestDoc/*:SyncCustomerSystemUserAccountVBMRequest</con2:path>
                                    </con2:param>
                                    <con2:param name="transactionId">
                                      <con2:path>$transactionId</con2:path>
                                    </con2:param>
                                  </con2:xqueryTransform>
                                </con3:expr>
                              </con3:replace>
                              <con1:log xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c42</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Request sent to IDM :-</con1:message>
                              </con1:log>
                            </con3:requestTransform>
                            <con3:responseTransform>
                              <con1:log xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c41</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Response received from  IDM :-</con1:message>
                              </con1:log>
                              <con3:ifThenElse xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                                <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c40</con2:id>
                                <con3:case>
                                  <con3:condition>
                                    <con2:xqueryConditionExpr>
                                      <con2:compExpr operator="=">
                                        <con2:leftPath>$body/*:LINK_MSISDNResponse/return/code/text()</con2:leftPath>
                                        <con2:rightPath>200</con2:rightPath>
                                      </con2:compExpr>
                                    </con2:xqueryConditionExpr>
                                  </con3:condition>
                                  <con3:actions/>
                                </con3:case>
                                <con3:default>
                                  <con3:ifThenElse>
                                    <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c3f</con2:id>
                                    <con3:case>
                                      <con3:condition>
                                        <con2:xqueryText>exists($body/*:LINK_MSISDNResponse/*:return/*:code/text()) and 
exists($body/*:LINK_MSISDNResponse/*:return/*:message/text())</con2:xqueryText>
                                      </con3:condition>
                                      <con3:actions>
                                        <con3:assign varName="errorCode">
                                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7c29</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>$body/*:LINK_MSISDNResponse/*:return/*:code/text()</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="errorDVM">
                                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-79d0</con2:id>
                                          <con3:expr>
                                            <con2:xqueryTransform>
                                              <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                                            </con2:xqueryTransform>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:replace varName="header">
                                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7bd3</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryTransform>
                                              <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                              <con2:param name="reasonCode">
                                                <con2:path>$errorCode</con2:path>
                                              </con2:param>
                                              <con2:param name="message">
                                                <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                              </con2:param>
                                              <con2:param name="transactionId">
                                                <con2:path>$transactionId</con2:path>
                                              </con2:param>
                                            </con2:xqueryTransform>
                                          </con3:expr>
                                        </con3:replace>
                                        <con3:replace varName="body">
                                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7b62</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                                          </con3:expr>
                                        </con3:replace>
                                        <con1:log>
                                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c3c</con2:id>
                                          <con1:logLevel>info</con1:logLevel>
                                          <con1:expr>
                                            <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                          </con1:expr>
                                          <con1:message>Response sent to Client::</con1:message>
                                        </con1:log>
                                        <con2:reply>
                                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c3b</con2:id>
                                        </con2:reply>
                                      </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                      <con3:Error>
                                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c3a</con2:id>
                                        <con3:errCode>error</con3:errCode>
                                        <con3:message>error</con3:message>
                                      </con3:Error>
                                    </con3:default>
                                  </con3:ifThenElse>
                                </con3:default>
                              </con3:ifThenElse>
                            </con3:responseTransform>
                          </con3:wsCallout>
                        </con3:actions>
                      </con3:case>
                      <con3:default>
                        <con1:log xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c38</con2:id>
                          <con1:logLevel>info</con1:logLevel>
                          <con1:expr>
                            <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                          </con1:expr>
                          <con1:message>Challenge ID Number / Type not matching with ODS</con1:message>
                        </con1:log>
                        <con3:assign varName="errorCode" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7ee8</con2:id>
                          <con3:expr>
                            <con2:xqueryText>"1017"</con2:xqueryText>
                          </con3:expr>
                        </con3:assign>
                        <con3:assign varName="errorDVM" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7a9a</con2:id>
                          <con3:expr>
                            <con2:xqueryTransform>
                              <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                            </con2:xqueryTransform>
                          </con3:expr>
                        </con3:assign>
                        <con3:replace varName="header" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7e93</con2:id>
                          <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                          </con3:location>
                          <con3:expr>
                            <con2:xqueryTransform>
                              <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                              <con2:param name="reasonCode">
                                <con2:path>$errorCode</con2:path>
                              </con2:param>
                              <con2:param name="message">
                                <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                              </con2:param>
                              <con2:param name="transactionId">
                                <con2:path>$transactionId</con2:path>
                              </con2:param>
                            </con2:xqueryTransform>
                          </con3:expr>
                        </con3:replace>
                        <con3:replace varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                          <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7e3f</con2:id>
                          <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                          </con3:location>
                          <con3:expr>
                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                          </con3:expr>
                        </con3:replace>
                        <con1:log>
                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c34</con2:id>
                          <con1:logLevel>info</con1:logLevel>
                          <con1:expr>
                            <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                          </con1:expr>
                          <con1:message>Response sent to Client::</con1:message>
                        </con1:log>
                        <con2:reply>
                          <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c33</con2:id>
                        </con2:reply>
                      </con3:default>
                    </con3:ifThenElse>
                  </con3:actions>
                </con3:case>
                <con3:default>
                  <con1:log xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                    <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c32</con2:id>
                    <con1:logLevel>info</con1:logLevel>
                    <con1:expr>
                      <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                    </con1:expr>
                    <con1:message>IDNumber/Type not matching in IDMAccount and ODS. Also Challenge ID Number / Type not provided . Error will be raised.</con1:message>
                  </con1:log>
                  <con3:assign varName="errorCode" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                    <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7af1</con2:id>
                    <con3:expr>
                      <con2:xqueryText>"1016"</con2:xqueryText>
                    </con3:expr>
                  </con3:assign>
                  <con3:assign varName="errorDVM" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                    <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7a98</con2:id>
                    <con3:expr>
                      <con2:xqueryTransform>
                        <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                      </con2:xqueryTransform>
                    </con3:expr>
                  </con3:assign>
                  <con3:replace varName="header" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                    <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7f92</con2:id>
                    <con3:location>
                      <con2:xpathText>.</con2:xpathText>
                    </con3:location>
                    <con3:expr>
                      <con2:xqueryTransform>
                        <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                        <con2:param name="reasonCode">
                          <con2:path>$errorCode</con2:path>
                        </con2:param>
                        <con2:param name="message">
                          <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                        </con2:param>
                        <con2:param name="transactionId">
                          <con2:path>$transactionId</con2:path>
                        </con2:param>
                      </con2:xqueryTransform>
                    </con3:expr>
                  </con3:replace>
                  <con3:replace varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                    <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7f90</con2:id>
                    <con3:location>
                      <con2:xpathText>.</con2:xpathText>
                    </con3:location>
                    <con3:expr>
                      <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                    </con3:expr>
                  </con3:replace>
                  <con1:log xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                    <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7f8e</con2:id>
                    <con1:logLevel>info</con1:logLevel>
                    <con1:expr>
                      <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                    </con1:expr>
                    <con1:message>Response sent to Client::</con1:message>
                  </con1:log>
                  <con2:reply xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                    <con2:id>_ActionId-5417508715634745014-6d5afe5f.16614a2eb83.-7f8c</con2:id>
                  </con2:reply>
                </con3:default>
              </con3:ifThenElse>
            </con3:default>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="CRM_LINK_MSISDN_response"/>
    <con:pipeline type="error" name="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c91">
      <con:stage name="ErrorHandlerStage11">
        <con:context/>
        <con:actions>
          <con2:resume>
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c90</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c8c">
      <con:stage name="ErrorHandlerStage11">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c8b</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>"Body Validation Failed"</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Technical"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>"3014"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"eGate"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"req does not contain all parameters"</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>data($validation//*:ValidationErrorList/*:ValidationError[1]/*:message)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c83">
      <con:stage name="ErrorHandlerStage1">
        <con:context/>
        <con:actions>
          <con3:ifThenElse>
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c82</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>exists($fault//*:ReceivedFaultDetail[1]/*:detail/*:jca-runtime-fault-detail/*:eis-error-message/text())</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:assign varName="errDesc">
                  <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c81</con2:id>
                  <con3:expr>
                    <con2:xqueryText>$fault//*:ReceivedFaultDetail[1]/*:detail/*:jca-runtime-fault-detail/*:eis-error-message/text()</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:ifThenElse>
                  <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c80</con2:id>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>contains(data($errDesc),"ORA-20099: MSISDN NOT FOUND!!!")</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:assign varName="errorCode">
                        <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7f7b</con2:id>
                        <con3:expr>
                          <con2:xqueryText>"1015"</con2:xqueryText>
                        </con3:expr>
                      </con3:assign>
                      <con3:assign varName="errorDVM">
                        <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7f79</con2:id>
                        <con3:expr>
                          <con2:xqueryTransform>
                            <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                          </con2:xqueryTransform>
                        </con3:expr>
                      </con3:assign>
                      <con3:replace varName="header">
                        <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7f77</con2:id>
                        <con3:location>
                          <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                          <con2:xqueryTransform>
                            <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                            <con2:param name="reasonCode">
                              <con2:path>$errorCode</con2:path>
                            </con2:param>
                            <con2:param name="message">
                              <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                            </con2:param>
                            <con2:param name="transactionId">
                              <con2:path>$transactionId</con2:path>
                            </con2:param>
                          </con2:xqueryTransform>
                        </con3:expr>
                      </con3:replace>
                      <con3:replace varName="body">
                        <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7f75</con2:id>
                        <con3:location>
                          <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                          <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:SyncCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                        </con3:expr>
                      </con3:replace>
                      <con1:log>
                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c7c</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                          <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>Response sent to Client::</con1:message>
                      </con1:log>
                      <con2:reply>
                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c7b</con2:id>
                      </con2:reply>
                    </con3:actions>
                  </con3:case>
                  <con3:default/>
                </con3:ifThenElse>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7c6e">
      <con:stage name="ErrorHandlerStage1">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7c6d</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>$transactionId</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"IDM"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"Error"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>$body/*:CRM_SEARCH_ALL_USERResponse/return/code/text()</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>$body/*:CRM_SEARCH_ALL_USERResponse/return/message/text()</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7ac8">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7ac7</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>$transactionId</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"IDM"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"Error"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>$body/*:CRM_UPDATE_USERResponse/return/code/text()</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>$body/*:CRM_UPDATE_USERResponse/return/message/text()</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="CRM_SEARCH_USER_request">
      <con:stage name="Generate Transaction Id">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
        </con:context>
        <con:actions>
          <con3:assign varName="transactionId">
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7ff4</con2:id>
            <con3:expr>
              <con2:xqueryText>if(exists($header/*:Correlation/*:ConversationID/text())) then
 $header/*:Correlation/*:ConversationID/text()
else
concat("CRM_SEARCH_USER","_",fn-bea:uuid())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestDoc">
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7ff3</con2:id>
            <con3:expr>
              <con2:xqueryText>$body</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="RequestSystem">
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7ff2</con2:id>
            <con3:expr>
              <con2:xqueryText>$header/*:Source/*:System</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="requestHeader">
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7ff1</con2:id>
            <con3:expr>
              <con2:xqueryText>$header</con2:xqueryText>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
      <con:stage name="LogRequest" errorHandler="_onErrorHandler-8881250876090147716-3edf8057.165f0f8cbd5.-7fef">
        <con:context/>
        <con:actions>
          <con1:log>
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7ff0</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
            </con1:expr>
            <con1:message>Request Received  :: CRM_SEARCH_USER::</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="ValidateRequest" errorHandler="_onErrorHandler-8881250876090147716-3edf8057.165f0f8cbd5.-7fea">
        <con:context>
          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
          <con2:varNsDecl prefix="urn" namespace="urn:un:unece:uncefact:documentation:standard:CoreComponentType:2"/>
          <con2:varNsDecl prefix="bf" namespace="http://docs.oasis-open.org/wsrf/bf-2"/>
          <con2:varNsDecl prefix="v11" namespace="http://group.vodafone.com/contract/vho/header/v1"/>
          <con2:varNsDecl prefix="xml" namespace="http://www.w3.org/XML/1998/namespace"/>
        </con:context>
        <con:actions>
          <con3:assign varName="validation">
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7fed</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_GetCustomerSystemUserAccountBodyValidation"/>
                <con2:param name="getCustomerSystemUserAccountListVBMRequest1">
                  <con2:path>$body/*:GetCustomerSystemUserAccountListVBMRequest</con2:path>
                </con2:param>
                <con2:param name="header">
                  <con2:path>$header</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7fec</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>count($validation/*:ValidationErrorList/*:ValidationError) > 0</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:Error>
                  <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7feb</con2:id>
                  <con3:errCode>validation-error</con3:errCode>
                  <con3:message>validation-error</con3:message>
                </con3:Error>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="CRM_SEARCH_USER_response"/>
    <con:pipeline type="error" name="_onErrorHandler-8881250876090147716-3edf8057.165f0f8cbd5.-7fef">
      <con:stage name="ErrorHandlerStage1">
        <con:context/>
        <con:actions>
          <con2:resume>
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7fee</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8881250876090147716-3edf8057.165f0f8cbd5.-7fea">
      <con:stage name="ErrorHandlerStage1">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7fe9</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>"Body Validation Failed"</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Technical"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>"3014"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"eGate"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"req does not contain all parameters"</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>data($validation//*:ValidationErrorList/*:ValidationError[1]/*:message)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8881250876090147716-3edf8057.165f0f8cbd5.-7c16">
      <con:stage name="ErrorHandlerStage">
        <con:context/>
        <con:actions>
          <con3:assign varName="errorinfo">
            <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c15</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="VFQA_CSM_Common/Trasformation/XQ_CreateErrorInformation"/>
                <con2:param name="TransactionID">
                  <con2:path>$transactionId</con2:path>
                </con2:param>
                <con2:param name="Category">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="MSISDN">
                  <con2:path>""</con2:path>
                </con2:param>
                <con2:param name="Severity">
                  <con2:path>"Minor"</con2:path>
                </con2:param>
                <con2:param name="System">
                  <con2:path>"IDM"</con2:path>
                </con2:param>
                <con2:param name="Description">
                  <con2:path>"Error"</con2:path>
                </con2:param>
                <con2:param name="ErrorCode">
                  <con2:path>$body/*:CRM_SEARCH_ALL_USERResponse/return/code/text()</con2:path>
                </con2:param>
                <con2:param name="ErrorDetail">
                  <con2:path>$body/*:CRM_SEARCH_ALL_USERResponse/return/message/text()</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:flow>
      <con:branch-node type="operation" name="BranchNode1">
        <con:context/>
        <con:branch-table>
          <con:branch name="CreateCustomerSystemUserAccount">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="PipelinePairNode1">
                <con:request>PipelinePairNode1_request</con:request>
                <con:response>PipelinePairNode1_response</con:response>
              </con:pipeline-node>
              <con:route-node name="RouteNode_CRM_CREATE_USER" error-handler="_onErrorHandler-3713613156946632844--5fb82158.16373885905.-78f6">
                <con:context>
                  <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
                </con:context>
                <con:actions>
                  <con4:route>
                    <con2:id>_ActionId-6974063277619847764-1d98b44a.1635976164a.-7fe7</con2:id>
                    <con4:service ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con4:operation>CRM_CREATE_USER</con4:operation>
                    <con4:outboundTransform>
                      <con3:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-6974063277619847764-1d98b44a.1635976164a.-7fcd</con2:id>
                        <con3:location>
                          <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                          <con2:xqueryTransform>
                            <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CreateCustomerSystemUserAccountVBMRequest_to_IDMCreateUserRequest"/>
                            <con2:param name="createCustomerSystemUserAccountVBMRequest1">
                              <con2:path>$body/*:CreateCustomerSystemUserAccountVBMRequest</con2:path>
                            </con2:param>
                            <con2:param name="transactionId">
                              <con2:path>$transactionId</con2:path>
                            </con2:param>
                          </con2:xqueryTransform>
                        </con3:expr>
                      </con3:replace>
                      <con1:log>
                        <con2:id>_ActionId-3438344862062793847--6156cfc4.164cd7be65e.-7f3e</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                          <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>Request sent to IDM ::</con1:message>
                      </con1:log>
                    </con4:outboundTransform>
                    <con4:responseTransform>
                      <con1:log>
                        <con2:id>_ActionId-3438344862062793847--6156cfc4.164cd7be65e.-7eea</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                          <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>Response received from  IDM ::</con1:message>
                      </con1:log>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-78f9</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryConditionExpr>
                              <con2:compExpr operator="=">
                                <con2:leftPath>$body/*:CRM_CREATE_USERResponse/return/code/text()</con2:leftPath>
                                <con2:rightPath>200</con2:rightPath>
                              </con2:compExpr>
                            </con2:xqueryConditionExpr>
                          </con3:condition>
                          <con3:actions>
                            <con3:replace varName="header">
                              <con2:id>_ActionId-7403373812276307397-10604d73.16537c1aa71.-7cb1</con2:id>
                              <con3:location>
                                <con2:xpathText>.</con2:xpathText>
                              </con3:location>
                              <con3:expr>
                                <con2:xqueryTransform>
                                  <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                  <con2:param name="transactionId">
                                    <con2:path>$transactionId</con2:path>
                                  </con2:param>
                                  <con2:param name="message">
                                    <con2:path>"SUCCESS"</con2:path>
                                  </con2:param>
                                  <con2:param name="reasonCode">
                                    <con2:path>"0000"</con2:path>
                                  </con2:param>
                                </con2:xqueryTransform>
                              </con3:expr>
                            </con3:replace>
                            <con3:replace contents-only="true" varName="body">
                              <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-78f7</con2:id>
                              <con3:expr>
                                <con2:xqueryTransform>
                                  <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_IDMCreateUserResponse_to_CreateCustomerSystemUserAccountResponse"/>
                                  <con2:param name="cRM_CREATE_USERResponse1">
                                    <con2:path>$body/*:CRM_CREATE_USERResponse</con2:path>
                                  </con2:param>
                                </con2:xqueryTransform>
                              </con3:expr>
                            </con3:replace>
                            <con1:log>
                              <con2:id>_ActionId-3438344862062793847--6156cfc4.164cd7be65e.-7e5b</con2:id>
                              <con1:logLevel>info</con1:logLevel>
                              <con1:expr>
                                <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                              </con1:expr>
                              <con1:message>Response sent to Client::</con1:message>
                            </con1:log>
                            <con2:reply>
                              <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7e1d</con2:id>
                            </con2:reply>
                          </con3:actions>
                        </con3:case>
                        <con3:default>
                          <con3:ifThenElse>
                            <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7e7b</con2:id>
                            <con3:case>
                              <con3:condition>
                                <con2:xqueryText>exists($body/*:CRM_CREATE_USERResponse/*:return/*:code/text()) and 
exists($body/*:CRM_CREATE_USERResponse/*:return/*:message/text())</con2:xqueryText>
                              </con3:condition>
                              <con3:actions>
                                <con3:assign varName="errorCode">
                                  <con2:id>_ActionId-5407782760876873835--5793d1ba.16604a8810a.-7ef2</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>$body/*:CRM_CREATE_USERResponse/*:return/*:code/text()</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="errorDVM">
                                  <con2:id>_ActionId-5407782760876873835--5793d1ba.16604a8810a.-7f1f</con2:id>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:assign>
                                <con3:replace varName="header">
                                  <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7d20</con2:id>
                                  <con3:location>
                                    <con2:xpathText>.</con2:xpathText>
                                  </con3:location>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                      <con2:param name="reasonCode">
                                        <con2:path>$errorCode</con2:path>
                                      </con2:param>
                                      <con2:param name="message">
                                        <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                      </con2:param>
                                      <con2:param name="transactionId">
                                        <con2:path>$transactionId</con2:path>
                                      </con2:param>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:replace>
                                <con3:replace varName="body">
                                  <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7e79</con2:id>
                                  <con3:location>
                                    <con2:xpathText>.</con2:xpathText>
                                  </con3:location>
                                  <con3:expr>
                                    <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
		<v13:CreateCustomerSystemUserAccountVBMResponse 
		xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
			<v13:CustomerSystemUserAccountVBO>
			  <ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
               <ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
            </ns3:Categories>
            </v13:CustomerSystemUserAccountVBO>
		</v13:CreateCustomerSystemUserAccountVBMResponse>
	</soapenv:Body>]]></con2:xqueryText>
                                  </con3:expr>
                                </con3:replace>
                                <con1:log>
                                  <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7d22</con2:id>
                                  <con1:logLevel>info</con1:logLevel>
                                  <con1:expr>
                                    <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                  </con1:expr>
                                  <con1:message>Response sent to Client::</con1:message>
                                </con1:log>
                                <con2:reply>
                                  <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7e75</con2:id>
                                </con2:reply>
                              </con3:actions>
                            </con3:case>
                            <con3:default>
                              <con3:Error>
                                <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7dc9</con2:id>
                                <con3:errCode>error</con3:errCode>
                                <con3:message>error</con3:message>
                              </con3:Error>
                            </con3:default>
                          </con3:ifThenElse>
                        </con3:default>
                      </con3:ifThenElse>
                    </con4:responseTransform>
                  </con4:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="GetCustomerSystemUserAccountList">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="CRM_SEARCH_USER">
                <con:request>CRM_SEARCH_USER_request</con:request>
                <con:response>CRM_SEARCH_USER_response</con:response>
              </con:pipeline-node>
              <con:route-node name="RouteNode11" error-handler="_onErrorHandler-8881250876090147716-3edf8057.165f0f8cbd5.-7c16">
                <con:context>
                  <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
                  <con2:varNsDecl namespace="http://group.vodafone.com/contract/vho/header/v1" prefix="v11"/>
                </con:context>
                <con:actions>
                  <con4:route>
                    <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c2f</con2:id>
                    <con4:service ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con4:operation>CRM_SEARCH_ALL_USER</con4:operation>
                    <con4:outboundTransform>
                      <con3:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c2e</con2:id>
                        <con3:expr>
                          <con2:xqueryTransform>
                            <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_GetCustomerSystemUserAccountListVBMRequest_to_IDMSearchUserRequest"/>
                            <con2:param name="getCustomerSystemUserAccountListVBMRequest1">
                              <con2:path>$body/*:GetCustomerSystemUserAccountListVBMRequest</con2:path>
                            </con2:param>
                            <con2:param name="transactionId">
                              <con2:path>$transactionId</con2:path>
                            </con2:param>
                          </con2:xqueryTransform>
                        </con3:expr>
                      </con3:replace>
                      <con1:log>
                        <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c2d</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                          <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>Request sent to IDM :-</con1:message>
                      </con1:log>
                    </con4:outboundTransform>
                    <con4:responseTransform>
                      <con1:log>
                        <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c2c</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                          <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>Response received from to IDM :-</con1:message>
                      </con1:log>
                      <con3:assign varName="crmSearchResponse">
                        <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c2b</con2:id>
                        <con3:expr>
                          <con2:xqueryText>$body</con2:xqueryText>
                        </con3:expr>
                      </con3:assign>
                      <con3:assign varName="ResultCode">
                        <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c2a</con2:id>
                        <con3:expr>
                          <con2:xqueryText>$body/*:CRM_SEARCH_ALL_USERResponse/return/code/text()</con2:xqueryText>
                        </con3:expr>
                      </con3:assign>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c29</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryConditionExpr>
                              <con2:compExpr operator="=">
                                <con2:leftPath>$body/*:CRM_SEARCH_ALL_USERResponse/return/code/text()</con2:leftPath>
                                <con2:rightPath>200</con2:rightPath>
                              </con2:compExpr>
                            </con2:xqueryConditionExpr>
                          </con3:condition>
                          <con3:actions>
                            <con3:assign varName="childProcessFormDataMergedResponse">
                              <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c28</con2:id>
                              <con3:expr>
                                <con2:xqueryText>&lt;childProcessFormDataMergedResponse>
&lt;/childProcessFormDataMergedResponse></con2:xqueryText>
                              </con3:expr>
                            </con3:assign>
                            <con3:foreach>
                              <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c22</con2:id>
                              <con3:variable>crmSearchResponse</con3:variable>
                              <con3:expression>
                                <con2:xpathText>./*:CRM_SEARCH_ALL_USERResponse/*:return</con2:xpathText>
                              </con3:expression>
                              <con3:value-variable>holderVar</con3:value-variable>
                              <con3:index-variable>ind</con3:index-variable>
                              <con3:total-variable>cnt</con3:total-variable>
                              <con3:actions>
                                <con3:wsCallout>
                                  <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c23</con2:id>
                                  <con3:service xsi:type="ref:BusinessServiceRef" ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                  <con3:operation>getChildProcessFormData</con3:operation>
                                  <con3:request>
                                    <con3:body wrapped="true">$body</con3:body>
                                  </con3:request>
                                  <con3:response>
                                    <con3:body wrapped="true">body</con3:body>
                                  </con3:response>
                                  <con3:requestTransform>
                                    <con3:replace contents-only="true" varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                                      <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c27</con2:id>
                                      <con3:expr>
                                        <con2:xqueryText><![CDATA[<idm:getChildProcessFormData xmlns:idm="http://vodafoneqatar.qa/vfqa/IDM_Phase2">
	<arg0>{data($holderVar/*:IDMAccountId)}</arg0>
	<arg1>{data($holderVar/*:user_Login)}</arg1>
	<arg1>{$transactionId}</arg1>
</idm:getChildProcessFormData>]]></con2:xqueryText>
                                      </con3:expr>
                                    </con3:replace>
                                    <con1:log>
                                      <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c26</con2:id>
                                      <con1:logLevel>info</con1:logLevel>
                                      <con1:expr>
                                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body),". count -",$ind)</con2:xqueryText>
                                      </con1:expr>
                                      <con1:message>Request sent to IDM :-</con1:message>
                                    </con1:log>
                                  </con3:requestTransform>
                                  <con3:responseTransform>
                                    <con1:log>
                                      <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c25</con2:id>
                                      <con1:logLevel>info</con1:logLevel>
                                      <con1:expr>
                                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                      </con1:expr>
                                      <con1:message>Response received from  IDM :-</con1:message>
                                    </con1:log>
                                    <con3:insert varName="childProcessFormDataMergedResponse">
                                      <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c24</con2:id>
                                      <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                      </con3:location>
                                      <con3:where>last-child</con3:where>
                                      <con3:expr>
                                        <con2:xqueryText>$body</con2:xqueryText>
                                      </con3:expr>
                                    </con3:insert>
                                  </con3:responseTransform>
                                </con3:wsCallout>
                              </con3:actions>
                            </con3:foreach>
                            <con1:log>
                              <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c21</con2:id>
                              <con1:logLevel>info</con1:logLevel>
                              <con1:expr>
                                <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($childProcessFormDataMergedResponse))</con2:xqueryText>
                              </con1:expr>
                              <con1:message>childProcessFormDataMergedResponse IDM :-</con1:message>
                            </con1:log>
                            <con3:replace varName="header">
                              <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c20</con2:id>
                              <con3:location>
                                <con2:xpathText>.</con2:xpathText>
                              </con3:location>
                              <con3:expr>
                                <con2:xqueryTransform>
                                  <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                  <con2:param name="transactionId">
                                    <con2:path>$transactionId</con2:path>
                                  </con2:param>
                                  <con2:param name="message">
                                    <con2:path>"SUCCESS"</con2:path>
                                  </con2:param>
                                  <con2:param name="reasonCode">
                                    <con2:path>"0000"</con2:path>
                                  </con2:param>
                                </con2:xqueryTransform>
                              </con3:expr>
                            </con3:replace>
                            <con3:replace varName="body" contents-only="true">
                              <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c1f</con2:id>
                              <con3:expr>
                                <con2:xqueryTransform>
                                  <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_IDMSearchResponse_to_GetCustomerSystemUserAccountListResponse"/>
                                  <con2:param name="additionalAttributes">
                                    <con2:path>$childProcessFormDataMergedResponse</con2:path>
                                  </con2:param>
                                  <con2:param name="cRM_SEARCH_USERResponse1">
                                    <con2:path>$crmSearchResponse/*:CRM_SEARCH_ALL_USERResponse</con2:path>
                                  </con2:param>
                                </con2:xqueryTransform>
                              </con3:expr>
                            </con3:replace>
                            <con1:log>
                              <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c1e</con2:id>
                              <con1:logLevel>info</con1:logLevel>
                              <con1:expr>
                                <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                              </con1:expr>
                              <con1:message>Response sent to client  :-</con1:message>
                            </con1:log>
                            <con2:reply>
                              <con2:id>_ActionId-8881250876090147716-3edf8057.165f0f8cbd5.-7c1d</con2:id>
                            </con2:reply>
                          </con3:actions>
                        </con3:case>
                        <con3:default>
                          <con3:ifThenElse>
                            <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f76</con2:id>
                            <con3:case>
                              <con3:condition>
                                <con2:xqueryText>exists($body/*:CRM_SEARCH_ALL_USERResponse/*:return/*:code/text()) and 
exists($body/*:CRM_SEARCH_ALL_USERResponse/*:return/*:message/text())</con2:xqueryText>
                              </con3:condition>
                              <con3:actions>
                                <con3:assign varName="errorCode">
                                  <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f53</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>$body/*:CRM_SEARCH_ALL_USERResponse/*:return/*:code/text()</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="errorDVM">
                                  <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f51</con2:id>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:assign>
                                <con3:replace varName="header">
                                  <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f4f</con2:id>
                                  <con3:location>
                                    <con2:xpathText>.</con2:xpathText>
                                  </con3:location>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                      <con2:param name="reasonCode">
                                        <con2:path>$errorCode</con2:path>
                                      </con2:param>
                                      <con2:param name="message">
                                        <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                      </con2:param>
                                      <con2:param name="transactionId">
                                        <con2:path>$transactionId</con2:path>
                                      </con2:param>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:replace>
                                <con3:replace varName="body">
                                  <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f74</con2:id>
                                  <con3:location>
                                    <con2:xpathText>.</con2:xpathText>
                                  </con3:location>
                                  <con3:expr>
                                    <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:GetCustomerSystemUserAccountListVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:GetCustomerSystemUserAccountListVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                                  </con3:expr>
                                </con3:replace>
                                <con1:log>
                                  <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f73</con2:id>
                                  <con1:logLevel>info</con1:logLevel>
                                  <con1:expr>
                                    <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                  </con1:expr>
                                  <con1:message>Response sent to Client::</con1:message>
                                </con1:log>
                                <con2:reply>
                                  <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f72</con2:id>
                                </con2:reply>
                              </con3:actions>
                            </con3:case>
                            <con3:default>
                              <con3:Error>
                                <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7f71</con2:id>
                                <con3:errCode>error</con3:errCode>
                                <con3:message>error</con3:message>
                              </con3:Error>
                            </con3:default>
                          </con3:ifThenElse>
                        </con3:default>
                      </con3:ifThenElse>
                    </con4:responseTransform>
                  </con4:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="SyncCustomerSystemUserAccount">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="CRM_LINK_MSISDN">
                <con:request>CRM_LINK_MSISDN_request</con:request>
                <con:response>CRM_LINK_MSISDN_response</con:response>
              </con:pipeline-node>
              <con:route-node name="RouteNodeToCRM_Sync" error-handler="_onErrorHandler-1642496401415863369--6ae89d2a.165eb7b2382.-7ac8">
                <con:context>
                  <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
                  <con2:varNsDecl prefix="urn" namespace="urn:un:unece:uncefact:documentation:standard:CoreComponentType:2"/>
                  <con2:varNsDecl prefix="bf" namespace="http://docs.oasis-open.org/wsrf/bf-2"/>
                  <con2:varNsDecl prefix="v11" namespace="http://group.vodafone.com/contract/vho/header/v1"/>
                  <con2:varNsDecl prefix="xml" namespace="http://www.w3.org/XML/1998/namespace"/>
                </con:context>
                <con:actions>
                  <con4:route>
                    <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7ad2</con2:id>
                    <con4:service ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_CRM_linkMSISDN" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con4:operation>Sync_1</con4:operation>
                    <con4:outboundTransform>
                      <con5:assign varName="credentials" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-2877368248258055451--49e30a88.1662e429b54.-7dfc</con6:id>
                        <con5:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:lookupBasicCredentials("VFQA_CSM_Common/Service Account/SA_Siebel")</con:xqueryText>
                        </con5:expr>
                      </con5:assign>
                      <con6:assign varName="header" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-2877368248258055451--49e30a88.1662e429b54.-7e50</con7:id>
                        <con6:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
      <wsse:Security soapenv:mustUnderstand="0" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
         <wsse:UsernameToken wsu:Id="UsernameToken-884EAA5F538E545FB415138608984321">
            <wsse:Username>{data($credentials/*:username)}</wsse:Username>
            <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{data($credentials/*:password)}</wsse:Password>
            <wsse:Nonce EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary">1XoQSDl2297ibfpzR7Prcw==</wsse:Nonce>
            <wsu:Created>2017-12-21T12:54:58.427Z</wsu:Created>
         </wsse:UsernameToken>
      </wsse:Security>
   </soapenv:Header>]]></con:xqueryText>
                        </con6:expr>
                      </con6:assign>
                      <con3:replace contents-only="true" varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7ad1</con2:id>
                        <con3:expr>
                          <con2:xqueryTransform>
                            <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_SyncCustomerSystemUserAccountVBMRequest_to_CRMSyncRequest"/>
                            <con2:param name="cRM_SEARCH_ALL_USERResponse1">
                              <con2:path>$IDMGetProfileResponse/*:CRM_SEARCH_ALL_USERResponse</con2:path>
                            </con2:param>
                          </con2:xqueryTransform>
                        </con3:expr>
                      </con3:replace>
                      <con1:log>
                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7ad0</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                          <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>Request sent to CRM :-</con1:message>
                      </con1:log>
                    </con4:outboundTransform>
                    <con4:responseTransform>
                      <con1:log>
                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7acf</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                          <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                        </con1:expr>
                        <con1:message>Response received from CRM:-</con1:message>
                      </con1:log>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7ace</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>exists($body/*:Sync_1_Output/*:Error_spcCode/text())</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:replace varName="header" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                              <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7500</con2:id>
                              <con3:location>
                                <con2:xpathText>.</con2:xpathText>
                              </con3:location>
                              <con3:expr>
                                <con2:xqueryTransform>
                                  <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                  <con2:param name="message">
                                    <con2:path>$body/*:Sync_1_Output/*:Error_spcMessage/text()</con2:path>
                                  </con2:param>
                                  <con2:param name="reasonCode">
                                    <con2:path>concat("EGATE_ERR_",$body/*:Sync_1_Output/*:Error_spcCode/text())</con2:path>
                                  </con2:param>
                                  <con2:param name="transactionId">
                                    <con2:path>$transactionId</con2:path>
                                  </con2:param>
                                </con2:xqueryTransform>
                              </con3:expr>
                            </con3:replace>
                            <con3:replace varName="body" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                              <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7acc</con2:id>
                              <con3:location>
                                <con2:xpathText>.</con2:xpathText>
                              </con3:location>
                              <con3:expr>
                                <con2:xqueryText>&lt;soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
		&lt;v13:SyncCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
			&lt;v13:CustomerSystemUserAccountVBO/>
		&lt;/v13:SyncCustomerSystemUserAccountVBMResponse>
	&lt;/soapenv:Body></con2:xqueryText>
                              </con3:expr>
                            </con3:replace>
                            <con2:reply xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                              <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7acb</con2:id>
                            </con2:reply>
                          </con3:actions>
                        </con3:case>
                        <con3:default>
                          <con3:replace varName="header">
                            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7491</con2:id>
                            <con3:location>
                              <con2:xpathText>.</con2:xpathText>
                            </con3:location>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                <con2:param name="transactionId">
                                  <con2:path>$transactionId</con2:path>
                                </con2:param>
                                <con2:param name="message">
                                  <con2:path>"SUCCESS"</con2:path>
                                </con2:param>
                                <con2:param name="reasonCode">
                                  <con2:path>"0000"</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:replace>
                          <con3:replace contents-only="true" varName="body">
                            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7aca</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_IDMLinkMSISDN_to_SyncCustomerSystemUserAccountResponse"/>
                                <con2:param name="syncCustomerSystemUserAccountVBMRequest1">
                                  <con2:path>$requestDoc/*:SyncCustomerSystemUserAccountVBMRequest</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:replace>
                          <con1:log>
                            <con2:id>_ActionId-1642496401415863369--6ae89d2a.165eb7b2382.-7ac9</con2:id>
                            <con1:logLevel>info</con1:logLevel>
                            <con1:expr>
                              <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                            </con1:expr>
                            <con1:message>Response sent to client :-</con1:message>
                          </con1:log>
                          <con2:reply xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:env="http://www.bea.com/wli/config/env">
                            <con2:id>_ActionId-6294382772078374511-1d24ffa4.16614712528.-7bc1</con2:id>
                          </con2:reply>
                        </con3:default>
                      </con3:ifThenElse>
                    </con4:responseTransform>
                  </con4:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="UpdateCustomerSystemUserAccount">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:branch-node type="condition" name="BranchNodeForUpdate">
                <con:context/>
                <con:branch-table variable="body">
                  <con:xpath>
                    <con2:xpathText>*:UpdateCustomerSystemUserAccountVBMRequest/*:CustomerSystemUserAccountVBO/*:Type/text()</con2:xpathText>
                  </con:xpath>
                  <con:branch name="CRM_UPDATE_USER">
                    <con:operator>equals</con:operator>
                    <con:value>"UpdateCustomerProfile"</con:value>
                    <con:flow>
                      <con:pipeline-node name="CRM_UpdateUser">
                        <con:request>CRM_UpdateUser_request</con:request>
                        <con:response>CRM_UpdateUser_response</con:response>
                      </con:pipeline-node>
                      <con:route-node name="RouteNodeToCRM_UPDATE_USER" error-handler="_onErrorHandler-3713613156946632844--5fb82158.16373885905.-7cc8">
                        <con:context>
                          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
                          <con2:varNsDecl prefix="urn" namespace="urn:un:unece:uncefact:documentation:standard:CoreComponentType:2"/>
                          <con2:varNsDecl prefix="bf" namespace="http://docs.oasis-open.org/wsrf/bf-2"/>
                          <con2:varNsDecl prefix="v11" namespace="http://group.vodafone.com/contract/vho/header/v1"/>
                          <con2:varNsDecl prefix="xml" namespace="http://www.w3.org/XML/1998/namespace"/>
                        </con:context>
                        <con:actions>
                          <con4:route>
                            <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7fb9</con2:id>
                            <con4:service ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con4:operation>CRM_UPDATE_USER</con4:operation>
                            <con4:outboundTransform>
                              <con3:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7f90</con2:id>
                                <con3:expr>
                                  <con2:xqueryTransform>
                                    <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_UpdateCustomerSystemUserAccountRequest_To_IDMUpdateUserRequest"/>
                                    <con2:param name="updateCustomerSystemUserAccountVBMRequest1">
                                      <con2:path>$body/*:UpdateCustomerSystemUserAccountVBMRequest</con2:path>
                                    </con2:param>
                                    <con2:param name="transactionId">
                                      <con2:path>$transactionId</con2:path>
                                    </con2:param>
                                  </con2:xqueryTransform>
                                </con3:expr>
                              </con3:replace>
                              <con1:log>
                                <con2:id>_ActionId-3874316405454465131--cc9e00c.1651350191a.-79b4</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Request sent to IDM :-</con1:message>
                              </con1:log>
                            </con4:outboundTransform>
                            <con4:responseTransform>
                              <con1:log>
                                <con2:id>_ActionId-3874316405454465131--cc9e00c.1651350191a.-7960</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Response received from IDM :-</con1:message>
                              </con1:log>
                              <con3:assign varName="resultcode">
                                <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7cfb</con2:id>
                                <con3:expr>
                                  <con2:xqueryText>$body/*:CRM_UPDATE_USERResponse/return/code/text()</con2:xqueryText>
                                </con3:expr>
                              </con3:assign>
                              <con3:ifThenElse>
                                <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7ce6</con2:id>
                                <con3:case>
                                  <con3:condition>
                                    <con2:xqueryConditionExpr>
                                      <con2:compExpr operator="=">
                                        <con2:leftPath>$body/*:CRM_UPDATE_USERResponse/return/code/text()</con2:leftPath>
                                        <con2:rightPath>200</con2:rightPath>
                                      </con2:compExpr>
                                    </con2:xqueryConditionExpr>
                                  </con3:condition>
                                  <con3:actions>
                                    <con3:replace varName="header">
                                      <con2:id>_ActionId-4027309534877280443-7062490.165e68912cd.-7caa</con2:id>
                                      <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                      </con3:location>
                                      <con3:expr>
                                        <con2:xqueryTransform>
                                          <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                          <con2:param name="transactionId">
                                            <con2:path>$transactionId</con2:path>
                                          </con2:param>
                                          <con2:param name="message">
                                            <con2:path>"SUCCESS"</con2:path>
                                          </con2:param>
                                          <con2:param name="reasonCode">
                                            <con2:path>"0000"</con2:path>
                                          </con2:param>
                                        </con2:xqueryTransform>
                                      </con3:expr>
                                    </con3:replace>
                                    <con3:replace contents-only="true" varName="body">
                                      <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7ce4</con2:id>
                                      <con3:expr>
                                        <con2:xqueryTransform>
                                          <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_IDMUpdateUserResponse_to_UpdateCustomerSystemUserAccountResponse"/>
                                          <con2:param name="cRM_UPDATE_USERResponse1">
                                            <con2:path>$body/*:CRM_UPDATE_USERResponse</con2:path>
                                          </con2:param>
                                        </con2:xqueryTransform>
                                      </con3:expr>
                                    </con3:replace>
                                    <con1:log>
                                      <con2:id>_ActionId-3874316405454465131--cc9e00c.1651350191a.-78ef</con2:id>
                                      <con1:logLevel>info</con1:logLevel>
                                      <con1:expr>
                                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                      </con1:expr>
                                      <con1:message>Response sent to client :-</con1:message>
                                    </con1:log>
                                  </con3:actions>
                                </con3:case>
                                <con3:default>
                                  <con3:ifThenElse>
                                    <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7c0d</con2:id>
                                    <con3:case>
                                      <con3:condition>
                                        <con2:xqueryText>exists($body/*:CRM_UPDATE_USERResponse/*:return/*:code/text()) and 
exists($body/*:CRM_UPDATE_USERResponse/*:return/*:message/text())</con2:xqueryText>
                                      </con3:condition>
                                      <con3:actions>
                                        <con3:assign varName="errorCode">
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7e5c</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>$body/*:CRM_UPDATE_USERResponse/*:return/*:code/text()</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="errorDVM">
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7e5a</con2:id>
                                          <con3:expr>
                                            <con2:xqueryTransform>
                                              <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                                            </con2:xqueryTransform>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:replace varName="header">
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7e58</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryTransform>
                                              <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                              <con2:param name="reasonCode">
                                                <con2:path>$errorCode</con2:path>
                                              </con2:param>
                                              <con2:param name="message">
                                                <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                              </con2:param>
                                              <con2:param name="transactionId">
                                                <con2:path>$transactionId</con2:path>
                                              </con2:param>
                                            </con2:xqueryTransform>
                                          </con3:expr>
                                        </con3:replace>
                                        <con3:replace varName="body">
                                          <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7c0b</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:UpdateCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:UpdateCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                                          </con3:expr>
                                        </con3:replace>
                                        <con1:log>
                                          <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7c0a</con2:id>
                                          <con1:logLevel>info</con1:logLevel>
                                          <con1:expr>
                                            <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                          </con1:expr>
                                          <con1:message>Response sent to Client::</con1:message>
                                        </con1:log>
                                        <con2:reply>
                                          <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7c09</con2:id>
                                        </con2:reply>
                                      </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                      <con3:Error>
                                        <con2:id>_ActionId-2367698277937732359-210ad60f.16532cee7e8.-7c08</con2:id>
                                        <con3:errCode>error</con3:errCode>
                                        <con3:message>error</con3:message>
                                      </con3:Error>
                                    </con3:default>
                                  </con3:ifThenElse>
                                </con3:default>
                              </con3:ifThenElse>
                            </con4:responseTransform>
                          </con4:route>
                        </con:actions>
                      </con:route-node>
                    </con:flow>
                  </con:branch>
                  <con:branch name="CRM_UNLOCK_USER">
                    <con:operator>equals</con:operator>
                    <con:value>"UNLOCK ACCOUNT"</con:value>
                    <con:flow>
                      <con:pipeline-node name="CRM_UnlockUser1">
                        <con:request>CRM_UnlockUser1_request</con:request>
                        <con:response>CRM_UnlockUser1_response</con:response>
                      </con:pipeline-node>
                      <con:route-node name="RouteNode6" error-handler="_onErrorHandler-3713613156946632844--5fb82158.16373885905.-7f2c">
                        <con:context>
                          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
                        </con:context>
                        <con:actions>
                          <con4:route>
                            <con2:id>_ActionId-8244639994519177330--5a473f71.1636fc18728.-7fec</con2:id>
                            <con4:service ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con4:operation>CRM_UNLOCK_USER</con4:operation>
                            <con4:outboundTransform>
                              <con3:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-8244639994519177330--5a473f71.1636fc18728.-7fcc</con2:id>
                                <con3:expr>
                                  <con2:xqueryTransform>
                                    <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_UpdateCustomerSystemUserAccountRequest_to_IDMUnlockUserRequest"/>
                                    <con2:param name="transactionId1">
                                      <con2:path>$transactionId</con2:path>
                                    </con2:param>
                                    <con2:param name="updateCustomerSystemUserAccountVBMRequest1">
                                      <con2:path>$body/*:UpdateCustomerSystemUserAccountVBMRequest</con2:path>
                                    </con2:param>
                                  </con2:xqueryTransform>
                                </con3:expr>
                              </con3:replace>
                              <con1:log>
                                <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7e3d</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Request sent to IDM :-</con1:message>
                              </con1:log>
                            </con4:outboundTransform>
                            <con4:responseTransform>
                              <con1:log>
                                <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7de9</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Response received from IDM :-</con1:message>
                              </con1:log>
                              <con3:assign varName="resultcode">
                                <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7edb</con2:id>
                                <con3:expr>
                                  <con2:xqueryText>$body/*:CRM_UNLOCK_USERResponse/return/code/text()</con2:xqueryText>
                                </con3:expr>
                              </con3:assign>
                              <con3:ifThenElse>
                                <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7f4a</con2:id>
                                <con3:case>
                                  <con3:condition>
                                    <con2:xqueryText>$resultcode="200"</con2:xqueryText>
                                  </con3:condition>
                                  <con3:actions>
                                    <con3:replace varName="header">
                                      <con2:id>_ActionId-4027309534877280443-7062490.165e68912cd.-7b91</con2:id>
                                      <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                      </con3:location>
                                      <con3:expr>
                                        <con2:xqueryTransform>
                                          <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                          <con2:param name="transactionId">
                                            <con2:path>$transactionId</con2:path>
                                          </con2:param>
                                          <con2:param name="message">
                                            <con2:path>"SUCCESS"</con2:path>
                                          </con2:param>
                                          <con2:param name="reasonCode">
                                            <con2:path>"0000"</con2:path>
                                          </con2:param>
                                        </con2:xqueryTransform>
                                      </con3:expr>
                                    </con3:replace>
                                    <con3:replace contents-only="true" varName="body">
                                      <con2:id>_ActionId-3713613156946632844--5fb82158.16373885905.-7f48</con2:id>
                                      <con3:expr>
                                        <con2:xqueryTransform>
                                          <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_IDMUnlockUserResponse_to_UpdateCustomerSystemUserAccountResponse"/>
                                          <con2:param name="cRM_UNLOCK_USERResponse1">
                                            <con2:path>$body/*:CRM_UNLOCK_USERResponse</con2:path>
                                          </con2:param>
                                        </con2:xqueryTransform>
                                      </con3:expr>
                                    </con3:replace>
                                    <con1:log>
                                      <con2:id>_ActionId-8920523664663042246-66a48835.1651d831705.-7d78</con2:id>
                                      <con1:logLevel>info</con1:logLevel>
                                      <con1:expr>
                                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                      </con1:expr>
                                      <con1:message>Response sent to client :-</con1:message>
                                    </con1:log>
                                  </con3:actions>
                                </con3:case>
                                <con3:default>
                                  <con3:ifThenElse>
                                    <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d6d</con2:id>
                                    <con3:case>
                                      <con3:condition>
                                        <con2:xqueryText>exists($body/*:CRM_UNLOCK_USERResponse/*:return/*:code/text()) and 
exists($body/*:CRM_UNLOCK_USERResponse/*:return/*:message/text())</con2:xqueryText>
                                      </con3:condition>
                                      <con3:actions>
                                        <con3:assign varName="errorCode">
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d6c</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>$body/*:CRM_UNLOCK_USERResponse/*:return/*:code/text()</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="errorDVM">
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d6b</con2:id>
                                          <con3:expr>
                                            <con2:xqueryTransform>
                                              <con2:resource ref="CustomerSystemUserAccount/DVM/IDMErrorMapping"/>
                                            </con2:xqueryTransform>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:replace varName="header">
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d6a</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryTransform>
                                              <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CustomerSystemUserAccount_HeaderGeneration"/>
                                              <con2:param name="reasonCode">
                                                <con2:path>$errorCode</con2:path>
                                              </con2:param>
                                              <con2:param name="message">
                                                <con2:path>data($errorDVM/*:rows/*:row[*:cell[1] =$errorCode]/*:cell[2])</con2:path>
                                              </con2:param>
                                              <con2:param name="transactionId">
                                                <con2:path>$transactionId</con2:path>
                                              </con2:param>
                                            </con2:xqueryTransform>
                                          </con3:expr>
                                        </con3:replace>
                                        <con3:replace varName="body">
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d69</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
	<v13:UpdateCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
		<v13:CustomerSystemUserAccountVBO>
			<ns3:Categories xmlns:ns3="http://group.vodafone.com/schema/common/v1">
				<ns3:Category listName="Reason Code">{$errorCode}</ns3:Category>
			</ns3:Categories>
		</v13:CustomerSystemUserAccountVBO>
	</v13:UpdateCustomerSystemUserAccountVBMResponse>
</soapenv:Body>]]></con2:xqueryText>
                                          </con3:expr>
                                        </con3:replace>
                                        <con1:log>
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d68</con2:id>
                                          <con1:logLevel>info</con1:logLevel>
                                          <con1:expr>
                                            <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                          </con1:expr>
                                          <con1:message>Response sent to Client::</con1:message>
                                        </con1:log>
                                        <con2:reply>
                                          <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d67</con2:id>
                                        </con2:reply>
                                      </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                      <con3:Error>
                                        <con2:id>_ActionId-1785538799723870656--4f118cac.1661043e970.-7d66</con2:id>
                                        <con3:errCode>error</con3:errCode>
                                        <con3:message>error</con3:message>
                                      </con3:Error>
                                    </con3:default>
                                  </con3:ifThenElse>
                                </con3:default>
                              </con3:ifThenElse>
                            </con4:responseTransform>
                          </con4:route>
                        </con:actions>
                      </con:route-node>
                    </con:flow>
                  </con:branch>
                  <con:branch name="CRM_CHANGE_PASSWORD">
                    <con:operator>equals</con:operator>
                    <con:value>"CRM_CHANGE_PASSWORD"</con:value>
                    <con:flow>
                      <con:pipeline-node name="CRM_CHANGE_PASSWORD1">
                        <con:request>CRM_CHANGE_PASSWORD1_request</con:request>
                        <con:response>CRM_CHANGE_PASSWORD1_response</con:response>
                      </con:pipeline-node>
                      <con:route-node name="RouteNodeChangePassword" error-handler="_onErrorHandler-3928442196395806374--77adbcdd.165188415ef.-7ed3">
                        <con:context>
                          <con2:varNsDecl namespace="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" prefix="v1"/>
                        </con:context>
                        <con:actions>
                          <con4:route>
                            <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7ed9</con2:id>
                            <con4:service ref="CustomerSystemUserAccount/BusinessService/BS_VFQA_IDM" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con4:operation>CRM_CHANGE_PASSWORD</con4:operation>
                            <con4:outboundTransform>
                              <con3:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7ed8</con2:id>
                                <con3:expr>
                                  <con2:xqueryTransform>
                                    <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_CRMChangePassword_To_IDMChangePassword"/>
                                    <con2:param name="transactionId1">
                                      <con2:path>$transactionId</con2:path>
                                    </con2:param>
                                    <con2:param name="updateCustomerSystemUserAccountVBMRequest1">
                                      <con2:path>$body/*:UpdateCustomerSystemUserAccountVBMRequest</con2:path>
                                    </con2:param>
                                  </con2:xqueryTransform>
                                </con3:expr>
                              </con3:replace>
                              <con1:log>
                                <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7f4e</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Request sent to IDM :-</con1:message>
                              </con1:log>
                            </con4:outboundTransform>
                            <con4:responseTransform>
                              <con1:log>
                                <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7efa</con2:id>
                                <con1:logLevel>info</con1:logLevel>
                                <con1:expr>
                                  <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                </con1:expr>
                                <con1:message>Response received from IDM :-</con1:message>
                              </con1:log>
                              <con3:assign varName="resultcode">
                                <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7ed7</con2:id>
                                <con3:expr>
                                  <con2:xqueryText>$body/*:CRM_CHANGE_PASSWORDResponse/return/code/text()</con2:xqueryText>
                                </con3:expr>
                              </con3:assign>
                              <con3:ifThenElse>
                                <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7ed6</con2:id>
                                <con3:case>
                                  <con3:condition>
                                    <con2:xqueryConditionExpr>
                                      <con2:compExpr operator="=">
                                        <con2:leftPath>$body/*:CRM_CHANGE_PASSWORDResponse/return/code/text()</con2:leftPath>
                                        <con2:rightPath>200</con2:rightPath>
                                      </con2:compExpr>
                                    </con2:xqueryConditionExpr>
                                  </con3:condition>
                                  <con3:actions>
                                    <con3:replace varName="header">
                                      <con2:id>_ActionId-7403373812276307397-10604d73.16537c1aa71.-79b2</con2:id>
                                      <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                      </con3:location>
                                      <con3:expr>
                                        <con2:xqueryText>$requestHeader</con2:xqueryText>
                                      </con3:expr>
                                    </con3:replace>
                                    <con3:replace varName="body" contents-only="true">
                                      <con2:id>_ActionId-3928442196395806374--77adbcdd.165188415ef.-7ed5</con2:id>
                                      <con3:expr>
                                        <con2:xqueryTransform>
                                          <con2:resource ref="CustomerSystemUserAccount/Transformation/XQ_IDMChangePasswordResponse_To_CRMChangePasswordResponse"/>
                                          <con2:param name="cRM_CHANGE_PASSWORDResponse1">
                                            <con2:path>$body/*:CRM_CHANGE_PASSWORDResponse</con2:path>
                                          </con2:param>
                                        </con2:xqueryTransform>
                                      </con3:expr>
                                    </con3:replace>
                                    <con1:log>
                                      <con2:id>_ActionId-7976856096727962172--22cc42d7.16518a6101b.-7ea4</con2:id>
                                      <con1:logLevel>info</con1:logLevel>
                                      <con1:expr>
                                        <con2:xqueryText>concat("TransactionId -",$transactionId ," Payload :- ",fn-bea:serialize($body))</con2:xqueryText>
                                      </con1:expr>
                                      <con1:message>Response sent to client :-</con1:message>
                                    </con1:log>
                                  </con3:actions>
                                </con3:case>
                                <con3:default>
                                  <con3:ifThenElse>
                                    <con2:id>_ActionId-6263576928775361429--4ff113dd.165344ca12c.-7b43</con2:id>
                                    <con3:case>
                                      <con3:condition>
                                        <con2:xqueryText>exists($body/*:CRM_CHANGE_PASSWORDResponse/*:return/*:code/text()) and 
exists($body/*:CRM_CHANGE_PASSWORDResponse/*:return/*:message/text())</con2:xqueryText>
                                      </con3:condition>
                                      <con3:actions>
                                        <con3:replace varName="header">
                                          <con2:id>_ActionId-6263576928775361429--4ff113dd.165344ca12c.-7b42</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryText><![CDATA[<soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:v1="http://group.vodafone.com/contract/vho/header/v1" xmlns:v11="http://group.vodafone.com/contract/vfo/fault/v1">
		<v11:ReasonCode>{concat("EGATE_ERR_",$body/*:CRM_CHANGE_PASSWORDResponse/*:return/*:code/text())}</v11:ReasonCode>
		<v11:Message>{$body/*:CRM_CHANGE_PASSWORDResponse/*:return/*:message/text()}</v11:Message>   
		<v1:Correlation>
			<v1:ConversationID>{$transactionId}</v1:ConversationID>
		</v1:Correlation>
	</soapenv:Header>]]></con2:xqueryText>
                                          </con3:expr>
                                        </con3:replace>
                                        <con3:replace varName="body">
                                          <con2:id>_ActionId-6263576928775361429--4ff113dd.165344ca12c.-7b41</con2:id>
                                          <con3:location>
                                            <con2:xpathText>.</con2:xpathText>
                                          </con3:location>
                                          <con3:expr>
                                            <con2:xqueryText>&lt;soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
		&lt;v13:UpdateCustomerSystemUserAccountVBMResponse xmlns:v13="http://group.vodafone.com/schema/vbm/identity/customer-system-user-account/v1" >
			&lt;v13:CustomerSystemUserAccountVBO/>
		&lt;/v13:UpdateCustomerSystemUserAccountVBMResponse>
	&lt;/soapenv:Body></con2:xqueryText>
                                          </con3:expr>
                                        </con3:replace>
                                        <con1:log>
                                          <con2:id>_ActionId-6263576928775361429--4ff113dd.165344ca12c.-7b40</con2:id>
                                          <con1:logLevel>info</con1:logLevel>
                                          <con1:expr>
                                            <con2:xqueryText>concat("TransactionId -",$transactionId ," . Payload :- ",fn-bea:serialize($body)," . Header :-",fn-bea:serialize($header))</con2:xqueryText>
                                          </con1:expr>
                                          <con1:message>Response sent to Client::</con1:message>
                                        </con1:log>
                                        <con2:reply>
                                          <con2:id>_ActionId-6263576928775361429--4ff113dd.165344ca12c.-7b3f</con2:id>
                                        </con2:reply>
                                      </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                      <con3:Error>
                                        <con2:id>_ActionId-6263576928775361429--4ff113dd.165344ca12c.-7b3e</con2:id>
                                        <con3:errCode>error</con3:errCode>
                                        <con3:message>error</con3:message>
                                      </con3:Error>
                                    </con3:default>
                                  </con3:ifThenElse>
                                </con3:default>
                              </con3:ifThenElse>
                            </con4:responseTransform>
                          </con4:route>
                        </con:actions>
                      </con:route-node>
                    </con:flow>
                  </con:branch>
                  <con:default-branch>
                    <con:flow>
                      <con:pipeline-node name="PipelinePairNode2">
                        <con:request>PipelinePairNode2_request</con:request>
                        <con:response>PipelinePairNode2_response</con:response>
                      </con:pipeline-node>
                    </con:flow>
                  </con:default-branch>
                </con:branch-table>
              </con:branch-node>
            </con:flow>
          </con:branch>
          <con:default-branch>
            <con:flow>
              <con:pipeline-node name="PipelinePairNode21">
                <con:request>PipelinePairNode21_request</con:request>
                <con:response>PipelinePairNode21_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:default-branch>
        </con:branch-table>
      </con:branch-node>
    </con:flow>
  </ser:router>
</xml-fragment>